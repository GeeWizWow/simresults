!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).SimResults={})}(this,(function(t){"use strict";
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */class e{_data={};put(t,e){this._data[t]=e}get(t){return this._data[t]}forget(t){return delete this._data[t],!0}flush(){return this._data={},!0}cacheParentCall(t,e,s){const r=`${t}_${s.join("_")}`,i=this.get(r);if(i)return i;const n=e(...s);return this.put(r,n),n}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */const s={Practice:"FP",Qualify:"Q",Warmup:"W",Race:"R",Unknown:"unknown"};class r{_type;_name;_game;_server;_track;_participants=[];_date;_dateString;_maxLaps;_maxMinutes;_chats=[];_incidents=[];_penalties=[];_mod;_allowedVehicles=[];_setupFixed;_raceWeekendIndex;_sessionIndex;_otherSettings={};_helper;constructor(t){this._helper=t||new n}setType(t){return this._type=t,this}getType(){return this._type}setName(t){return this._name=t,this}getName(){return this._name}setGame(t){return this._game=t,this}getGame(){return this._game}setServer(t){return this._server=t,this}getServer(){return this._server}setTrack(t){return this._track=t,this}getTrack(){return this._track}setParticipants(t){return this._participants=t,this}addParticipant(t){return this._participants.push(t),this}getParticipants(){return this._participants}setDate(t){return this._date=t,this}getDate(){return this._date}setDateString(t){return this._dateString=t,this}getDateString(){return this._dateString}setMaxLaps(t){return this._maxLaps=t,this}getMaxLaps(){return this._maxLaps}setMaxMinutes(t){return this._maxMinutes=t,this}getMaxMinutes(){return this._maxMinutes}setChats(t){return this._chats=t,this}addChat(t){return this._chats.push(t),this}getChats(){return this._chats}setIncidents(t){return this._incidents=t,this}addIncident(t){return this._incidents.push(t),this}getIncidents(){return this._incidents}getIncidentsForReview(){return this._incidents.filter((t=>t.isForReview()))}setPenalties(t){return this._penalties=t,this}addPenalty(t){return this._penalties.push(t),this}getPenalties(){return this._penalties}setMod(t){return this._mod=t,this}getMod(){return this._mod}setAllowedVehicles(t){return this._allowedVehicles=t,this}addAllowedVehicle(t){return this._allowedVehicles.push(t),this}getAllowedVehicles(){return this._allowedVehicles}setSetupFixed(t){return this._setupFixed=t,this}isSetupFixed(){return this._setupFixed}setOtherSettings(t){return this._otherSettings=t,this}addOtherSetting(t,e){return this._otherSettings[t]=e,this}getOtherSettings(){return this._otherSettings}setRaceWeekendIndex(t){return this._raceWeekendIndex=t,this}getRaceWeekendIndex(){return this._raceWeekendIndex}setSessionIndex(t){return this._sessionIndex=t,this}getSessionIndex(){return this._sessionIndex}getLapsSortedByTime(){const t=this._participants.reduce(((t,e)=>[...t,...e.getLaps()]),[]);return this._helper.sortLapsByTime(t)}getBestLap(){return this.getLapsSortedByTime().find((t=>t.isCompleted()))}getLapsByLapNumberSortedByTime(t){const e=this._participants.reduce(((e,s)=>{const r=s.getLap(t);return r?[...e,r]:e}),[]);return this._helper.sortLapsByTime(e)}getBestLapByLapNumber(t){return this.getLapsByLapNumberSortedByTime(t)[0]||null}getBestLapsGroupedByParticipant(){const t=this._participants.reduce(((t,e)=>{const s=e.getBestLap();return s?[...t,s]:t}),[]);return this._helper.sortLapsByTime(t)}getLapsSortedBySector(t){const e=this._participants.reduce(((t,e)=>[...t,...e.getLaps()]),[]);return this._helper.sortLapsBySector(e,t)}getBestLapBySector(t){return this.getLapsSortedBySector(t)[0]||null}getBestLapsBySectorGroupedByParticipant(t){const e=this._participants.reduce(((e,s)=>{const r=s.getBestLapBySector(t);return r?[...e,r]:e}),[]);return this._helper.sortLapsBySector(e,t)}getLapsSortedBySectorByLapNumber(t,e){const s=this._participants.reduce(((t,s)=>{const r=s.getLap(e);return r?[...t,r]:t}),[]);return this._helper.sortLapsBySector(s,t)}getBestLapBySectorByLapNumber(t,e){return this.getLapsSortedBySectorByLapNumber(t,e)[0]||null}getBadLaps(t=107){const e=this.getBestLap();if(!e)return[];const s=this.getLapsSortedByTime(),r=e.getTime()*(t/100);return s.filter((t=>t.isCompleted()&&t.getTime()>r))}getCuts(){const t=[];return this._participants.forEach((e=>{e.getLaps().forEach((e=>{t.push(...e.getCuts())}))})),[...t].sort(((t,e)=>{const s=t.getDate(),r=e.getDate();return s||r?s?r?s===r?0:s<r?-1:1:-1:1:0}))}getLedMostParticipant(){let t;return this._participants.forEach((e=>{t?e.getNumberOfLapsLed()>t.getNumberOfLapsLed()&&(t=e):t=e})),t}getWinningParticipant(){return this.getParticipants()[0]||null}getLeadingParticipant(t){return this._participants.find((e=>{const s=e.getLap(t);return s&&1===s.getPosition()}))}getLeadingParticipantByElapsedTime(t){let e;return this._participants.forEach((s=>{const r=s.getLap(t);if(!r)return;(!e||r.getElapsedSeconds()&&(!r.getElapsedSeconds()||r.getElapsedSeconds()<e.getElapsedSeconds()))&&(e=r)})),e&&e.getParticipant()||null}getParticipantsSortedByConsistency(){return this._helper.sortParticipantsByConsistency(this.getParticipants())}getLastedLaps(){let t=0;return this._participants.forEach((e=>{const s=e.getNumberOfLaps();s>t&&(t=s)})),t}getMaxPosition(){let t=0;return this._participants.forEach((e=>{e.getLaps()&&e.getLaps().length&&(e.getGridPosition()&&e.getGridPosition()>t&&(t=e.getGridPosition()),e.getLaps().forEach((e=>{e.getPosition()&&e.getPosition()>t&&(t=e.getPosition())})))})),t}splitByVehicleClass(){throw new Error("Not Implemented")}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */class i extends r{_cache;constructor(t,s){super(t),this._cache=s||new e}static createInstance(){return new i}getLapsSortedByTime(){return this._cache.cacheParentCall("getLapsSortedByTime",super.getLapsSortedByTime.bind(this),[...arguments])}getLapsByLapNumberSortedByTime(t){return this._cache.cacheParentCall("getLapsByLapNumberSortedByTime",super.getLapsByLapNumberSortedByTime.bind(this),[...arguments])}getBestLapByLapNumber(t){return this._cache.cacheParentCall("getBestLapByLapNumber",super.getBestLapByLapNumber.bind(this),[...arguments])}getBestLapsGroupedByParticipant(){return this._cache.cacheParentCall("getBestLapsGroupedByParticipant",super.getBestLapsGroupedByParticipant.bind(this),[...arguments])}getLapsSortedBySector(t){return this._cache.cacheParentCall("getLapsSortedBySector",super.getLapsSortedBySector.bind(this),[...arguments])}getBestLapsBySectorGroupedByParticipant(t){return this._cache.cacheParentCall("getBestLapsBySectorGroupedByParticipant",super.getBestLapsBySectorGroupedByParticipant.bind(this),[...arguments])}getLapsSortedBySectorByLapNumber(t,e){return this._cache.cacheParentCall("getLapsSortedBySectorByLapNumber",super.getLapsSortedBySectorByLapNumber.bind(this),[...arguments])}getBestLapBySectorByLapNumber(t,e){return this._cache.cacheParentCall("getBestLapBySectorByLapNumber",super.getBestLapBySectorByLapNumber.bind(this),[...arguments])}getBadLaps(t=107){return this._cache.cacheParentCall("getBadLaps",super.getBadLaps.bind(this),[...arguments])}getLedMostParticipant(){return this._cache.cacheParentCall("getLedMostParticipant",super.getLedMostParticipant.bind(this),[...arguments])}getLeadingParticipant(t){return this._cache.cacheParentCall("getLeadingParticipant",super.getLeadingParticipant.bind(this),[...arguments])}getLeadingParticipantByElapsedTime(t){return this._cache.cacheParentCall("getLeadingParticipantByElapsedTime",super.getLeadingParticipantByElapsedTime.bind(this),[...arguments])}getLastedLaps(){return this._cache.cacheParentCall("getLastedLaps",super.getLastedLaps.bind(this),[...arguments])}getMaxPosition(){return this._cache.cacheParentCall("getMaxPosition",super.getMaxPosition.bind(this),[...arguments])}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */class n{uniqBy(t,e){const s=[],r=[];for(var i=0,n=t.length;i<n;i++){const n=t[i],a=n[e];-1===r.indexOf(a)&&(r.push(a),s.push(n))}return s}formatTime(t,e=!1){const s=t<0,r=s?Math.abs(t):t,i=Math.trunc(r),n=Math.floor(i/3600),a=Math.floor((i-3600*n)/60),o=(t-i+Math.floor(i-3600*n-60*a)).toFixed(4).padStart(7,"0");let h=`${a.toFixed(0).padStart(2,"0")}:${o}`;if(n||e){h=`${n.toFixed(0).padStart(2,"0")}:${h}`}return s&&(h=`-${h}`),h}sortLapsBySector(t,e){return[...t].sort(((t,s)=>{const r=e-1,i=t.getSectorTimes(),n=s.getSectorTimes();return i[r]||n[r]?i[r]?n[r]?i[r]===n[r]?0:i[r]<n[r]?-1:1:-1:1:0}))}sortLapsByTime(t){return[...t].sort(((t,e)=>t.getTime()===e.getTime()?0:t.isCompleted()?e.isCompleted()?t.getTime()<e.getTime()?-1:1:-1:1))}sortLapsByElapsedTime(t){return[...t].sort(((t,e)=>t.getElapsedSeconds()===e.getElapsedSeconds()?t.getTime()===e.getTime()?0:t.getTime()<e.getTime()?-1:1:t.getElapsedSeconds()?e.getElapsedSeconds()?t.isCompleted()?e.isCompleted()?t.getElapsedSeconds()<e.getElapsedSeconds()?-1:1:-1:1:-1:1))}sortParticipantsByTotalTime(t){return[...t].sort(((t,e)=>{if(t.getNumberOfLaps()<e.getNumberOfLaps())return 1;if(e.getNumberOfLaps()<t.getNumberOfLaps())return-1;if(!(t.getFinishStatus()!==o.None&&t.getFinishStatus()!==o.DQ&&t.getFinishStatus()!==o.DNF||e.getFinishStatus()!==o.None&&e.getFinishStatus()!==o.DQ&&e.getFinishStatus()!==o.DNF)){if(!t.getTotalTime()&&!e.getTotalTime()){if(t.getFinishStatus()===e.getFinishStatus()){if(t.getGridPosition()&&e.getGridPosition()){if(t.getGridPosition()<e.getGridPosition())return-1;if(e.getGridPosition()<t.getGridPosition())return 1}return t.getGridPosition()?-1:e.getGridPosition()?1:0}return h.finishSortOrder.findIndex((e=>e===t.getFinishStatus()))<h.finishSortOrder.findIndex((t=>t===e.getFinishStatus()))?-1:1}return t.getTotalTime()<e.getTotalTime()?1:-1}if(t.getFinishStatus()===o.None||t.getFinishStatus()===o.DQ||t.getFinishStatus()===o.DNF)return 1;if(e.getFinishStatus()===o.None||e.getFinishStatus()===o.DQ||e.getFinishStatus()===o.DNF)return-1;if(t.getTotalTime()===e.getTotalTime()){if(t.getGridPosition()&&e.getGridPosition()){if(t.getGridPosition()<e.getGridPosition())return-1;if(e.getGridPosition()<t.getGridPosition())return 1}return t.getGridPosition()?-1:e.getGridPosition()?1:0}return t.getTotalTime()<e.getTotalTime()?-1:1}))}sortParticipantsByBestLap(t){const e=[],s=[];t.forEach((t=>{const r=t.getBestLap();r?e.push(r):s.push(t)}));return[...this.sortLapsByTime(e).reduce(((t,e)=>{const s=e.getParticipant();return s?[...t,s]:t}),[]),...s]}sortParticipantsByConsistency(t){return[...t].sort(((t,e)=>{const s=t.getConsistency(),r=e.getConsistency();return s||r?s?r?s===r?0:s<r?-1:1:-1:1:0}))}sortParticipantsByLastLapPosition(t){return[...t].sort(((t,e)=>{const s=t.getNumberOfLaps(),r=e.getNumberOfLaps();if(!s&&!r)return 0;if(!s)return 1;if(!r)return-1;if(s!==r)return s<r?1:-1;const i=t.getLastLap(),n=e.getLastLap();return i||n?i?n?i.getPosition()<n.getPosition()?-1:1:-1:1:0}))}detectSession(t,e={}){const r=t.toLowerCase();let n="Unknown",a={p:s.Practice,fp:s.Practice,q:s.Qualify,r:s.Race,w:s.Warmup,...e}[r];return a||(a=s.Practice,n="Unknown"),n||(n=a.toLowerCase(),n=n.charAt(0).toUpperCase()+n.slice(1)),i.createInstance().setType(a).setName(n)}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */class a{_number;_participant;_driver;_vehicle;_position;_time;_aids=[];_sectorTimes=[];_elapsedSeconds;_frontCompound;_rearCompound;_frontCompoundLeftWear;_frontCompoundRightWear;_rearCompoundLeftWear;_rearCompoundRightWear;_fuel;_pitLap=!1;_pitTime;_cuts=[];_helper;constructor(t){this._helper=t||new n}setNumber(t){return this._number=t,this}getNumber(){return this._number}setParticipant(t){return this._participant=t,this}getParticipant(){return this._participant}setDriver(t){return this._driver=t,this}getDriver(){return this._driver}setVehicle(t){return this._vehicle=t,this}getVehicle(){return this._vehicle||this._participant&&this._participant.getVehicle(!0)}setPosition(t){return this._position=t,this}getPosition(){return this._position}setTime(t){return this._time=t,this}getTime(){if(!this._time&&3===this.getSectorTimes().length){const t=this.getSectorTimes().reduce(((t,e)=>t+e),0);return t>0&&t||0}return this._time}setSectorTimes(t){return this._sectorTimes=t,this}getSectorTimes(){return this._sectorTimes}getSectorTime(t){return this._sectorTimes[t-1]||0}addSectorTime(t){return this._sectorTimes.push(t),this}setAids(t){return this._aids=t,this}getAids(){return this._aids}addAid(t){return this._aids.push(t),this}setElapsedSeconds(t){return this._elapsedSeconds=t,this}getElapsedSeconds(){return this._elapsedSeconds}setFrontCompound(t){return this._frontCompound=t,this}getFrontCompound(){return this._frontCompound}setRearCompound(t){return this._rearCompound=t,this}getRearCompound(){return this._rearCompound}setFrontCompoundLeftWear(t){return this._frontCompoundLeftWear=t,this}getFrontCompoundLeftWear(){return this._frontCompoundLeftWear}setFrontCompoundRightWear(t){return this._frontCompoundRightWear=t,this}getFrontCompoundRightWear(){return this._frontCompoundRightWear}setRearCompoundLeftWear(t){return this._rearCompoundLeftWear=t,this}getRearCompoundLeftWear(){return this._rearCompoundLeftWear}setRearCompoundRightWear(t){return this._rearCompoundRightWear=t,this}getRearCompoundRightWear(){return this._rearCompoundRightWear}setFuel(t){return this._fuel=t,this}getFuel(){return this._fuel}setPitLap(t){return this._pitLap=t,this}isPitLap(){return this._pitLap}setPitTime(t){return this._pitTime=t,this}getCuts(){return this._cuts}addCut(t){this._cuts.push(t)}getNumberOfCuts(){return this._cuts.length}getCutsTime(){return this._cuts.reduce(((t,e)=>t+e.getCutTime()),0)}getCutsTimeSkipped(){return this._cuts.reduce(((t,e)=>t+e.getTimeSkipped()),0)}getPitTime(){throw new Error("Not Implemented")}isCompleted(){const t=this.getTime();return Boolean(t&&t>0)}getGap(t){const e=this.getTime(),s=t.getTime();return e&&s?e-s:0}getSectorGap(t,e){const s=this.getSectorTimes(),r=t.getSectorTimes();return s[e-1]&&r[e-1]?r[e-1]-s[e-1]:0}toString(){return this._helper.formatTime(this._time)}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */const o={Normal:"finished",None:"none",DNF:"dnf",DQ:"dq"};class h{static finishSortOrder=[o.Normal,o.DNF,o.DQ,o.None];_drivers=[];_team;_vehicle;_position;_gridPosition;_classPosition;_classGridPosition;_laps=[];_totalTime;_pitstops=0;_finishStatus=o.None;_finishStatusComment;_helper;constructor(t){this._helper=t||new n}setDrivers(t){return this._drivers=t,this}getDrivers(){return this._drivers}getDriver(t=1){return this._drivers[t-1]}setTeam(t){return this._team=t,this}getTeam(){return this._team}setVehicle(t){return this._vehicle=t,this}getVehicle(t=!1){if(!t){const t=this.getVehicles();if(t.length>0){const e=this.getBestLap(),s=e&&e.getVehicle();return s||t[0]}}return this._vehicle}getVehicles(){const t=this._laps.reduce(((t,e)=>{const s=e.getVehicle();return s?[...t,s]:t}),[]),e=this._helper.uniqBy(t,"name");return!e.length&&this._vehicle?[this._vehicle]:e}setPosition(t){return this._position=t,this}getPosition(){return this._position}setGridPosition(t){return this._gridPosition=t,this}getGridPosition(){return this._gridPosition}setClassPosition(t){return this._classPosition=t,this}getClassPosition(){return this._classPosition}setClassGridPosition(t){return this._classGridPosition=t,this}getClassGridPosition(){return this._classGridPosition}setLaps(t){return this._laps=t,this}getLaps(){return this._laps}addLap(t){if(!t.getNumber())if(this._laps.length){const e=this._laps[this._laps.length-1];t.setNumber(e.getNumber()+1)}else t.setNumber(1);return this._laps.push(t),this}getLap(t){return this._laps.find((e=>e.getNumber()===t))}getLastLap(){return this._laps[this._laps.length-1]||null}setPitstops(t){return this._pitstops=t,this}getPitstops(){return this._pitstops}setFinishStatus(t){return this._finishStatus=t,this}getFinishStatus(){return this._finishStatus}setFinishComment(t){return this._finishStatusComment=t,this}getFinishStatusComment(){return this._finishStatusComment}setTotalTime(t){return this._totalTime=t,this}getTotalTime(){if(this._totalTime)return this._totalTime;const t=this.getLaps().reduce(((t,e)=>e.isCompleted()?t+e.getTime():t),0);return this._totalTime=t}getTotalTimeGap(t){let e=t.getTotalTime()-this.getTotalTime(),s=this.getNumberOfLaps()-t.getNumberOfLaps();if(0!==s){const r=s>0?this:t;for(let t=r.getNumberOfLaps();t>r.getNumberOfLaps()-Math.abs(s);t--){const i=r.getLap(t);i&&(s<0?e-=i.getTime():e+=i.getTime())}}return e}getLapsSortedByTime(){return this._helper.sortLapsByTime(this.getLaps())}getBestLap(){if(0===this._laps.length)return null;return this.getLapsSortedByTime().find((t=>t.isCompleted()))||null}getNumberOfLaps(){return this.getLaps().length}getNumberOfCompletedLaps(){return this.getLaps().filter((t=>t.isCompleted())).length}getNumberOfLapsLed(){return this.getLaps().filter((t=>1===t.getPosition())).length}getLapsSortedBySector(t){return this._helper.sortLapsBySector(this.getLaps(),t)}getBestLapBySector(t){return this.getLapsSortedBySector(t)[0]||null}getPositionDifference(){return this.getGridPosition()?this.getGridPosition()-this.getPosition():0}getAids(){return this.getLaps().reduce(((t,e)=>t.concat(e.getAids())),[])}getAverageLap(t=!1){if(!this.getNumberOfCompletedLaps())return null;let e;const s=[0,0,0],r=[0,0,0];if(this.getLaps().forEach((i=>{for(let n=0;n<3;n++){const a=i.getSectorTime(n+1);a&&!(t&&i.isPitLap()&&2===n)&&!(t&&e&&e.isPitLap()&&0===n)&&(s[n]=s[n]+a,r[n]=r[n]+1)}e=i})),!r[0]||!r[1]||!r[2])return null;const i=[s[0]/r[0],s[1]/r[1],s[2]/r[2]],n=i.reduce(((t,e)=>t+e),0);return(new a).setSectorTimes(i).setTime(n).setParticipant(this)}getBestPossibleLap(){const t=this.getBestLapBySector(1),e=this.getBestLapBySector(2),s=this.getBestLapBySector(3);if(!t||!e||!s)return null;const r=t.getSectorTime(1),i=e.getSectorTime(2),n=s.getSectorTime(3);return r&&i&&n?(new a).setSectorTimes([r,i,n]).setTime(r+i+n).setParticipant(this):null}getConsistency(t=!0){if(this.getNumberOfCompletedLaps()<=1)return null;let e=0,s=0;const r=this.getBestLap();if(!r)return null;if(this.getLaps().forEach(((i,n)=>{i.getTime()===r.getTime()||!i.isCompleted()||i.isPitLap()||i.getTime()>=r.getTime()+21||t&&0===n||(e+=i.getTime(),s++)})),!s)return null;return e/s-r.getTime()}getConsistencyPercentage(t=!0){const e=this.getConsistency(t),s=this.getBestLap();return e&&s?100-e/(s.getTime()/100):0}getDriverPercentage(t){let e=0;return this.getLaps().forEach((t=>{const s=t.getDriver();s&&s.getName()==s.getName()&&e++})),e?100/this.getNumberOfLaps()*e:0}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */class p extends h{_cache;constructor(t,s){super(t),this._cache=s||new e}static createInstance(){return new p}getLap(t){return this._cache.cacheParentCall("getLap",super.getLap.bind(this),[...arguments])}getVehicles(){return this._cache.cacheParentCall("getVehicles",super.getVehicles.bind(this),[...arguments])}getLapsSortedByTime(){return this._cache.cacheParentCall("getLapsSortedByTime",super.getLapsSortedByTime.bind(this),[...arguments])}getBestLap(){return this._cache.cacheParentCall("getBestLap",super.getBestLap.bind(this),[...arguments])}getNumberOfCompletedLaps(){return this._cache.cacheParentCall("getNumberOfCompletedLaps",super.getNumberOfCompletedLaps.bind(this),[...arguments])}getNumberOfLapsLed(){return this._cache.cacheParentCall("getNumberOfLapsLed",super.getNumberOfLapsLed.bind(this),[...arguments])}getLapsSortedBySector(t){return this._cache.cacheParentCall("getLapsSortedBySector",super.getLapsSortedBySector.bind(this),[...arguments])}getBestLapBySector(t){return this._cache.cacheParentCall("getBestLapBySector",super.getBestLapBySector.bind(this),[...arguments])}getAverageLap(t=!1){return this._cache.cacheParentCall("getAverageLap",super.getAverageLap.bind(this),[...arguments])}getBestPossibleLap(){return this._cache.cacheParentCall("getBestPossibleLap",super.getBestPossibleLap.bind(this),[...arguments])}getConsistency(t=!0){return this._cache.cacheParentCall("getConsistency",super.getConsistency.bind(this),[...arguments])}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */
class u{_name;_human=!0;_driverId;setName(t){return this._name=t,this}getName(t,e){if(t||e)throw new Error("Not Implemented");return this._name}getNameWithAiMention(){const t=this.getName();return this._human?t:`${t} (AI)`}setHuman(t){return this._human=t,this}isHuman(){return this._human}setDriverId(t){return this._driverId=t,this}getDriverId(){return this._driverId}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */class c{_name;_version;setName(t){return this._name=t,this}getName(){return this._name}setVersion(t){return this._version=t,this}getVersion(){return this._version}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */const d={Unknown:0,Car:"car",Env:"env",Other:"other"};
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */
const g=0;class l{_type=g;_message;_date;_elapsedSeconds;_participant;_lap;_servedLap;_served;_reason;_penalty;setMessage(t){return this._message=t,this}getMessage(){return this._message}setDate(t){return this._date=t,this}getDate(){return this._date}setElapsedSeconds(t){return this._elapsedSeconds=t,this}getElapsedSeconds(){return this._elapsedSeconds}setType(t){return this._type=t,this}getType(){return this._type}setParticipant(t){return this._participant=t,this}getParticipant(){return this._participant}setLap(t){return this._lap=t,this}getLap(){return this.lap}setServedLap(t){return this._servedLap=t,this}getServedLap(){return this._servedLap}setServed(t){return this._served=t,this}isServed(){return this._served}setReason(t){return this._reason=t,this}getReason(){return this._reason}setPenalty(t){return this._penalty=t,t}getPenalty(){return this._penalty}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */class _{_name;_motd;_dedicated;setName(t){return this._name=t,this}getName(){return this._name}setMotd(t){return this._motd=t,this}getMotd(){return this._motd}setDedicated(t){return this._dedicated=t,this}isDedicated(){return this._dedicated}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */class m{_venue;_course;_event;_length;setVenue(t){return this._venue=t,this}getVenue(){return this._venue}setCourse(t){return this._course=t,this}getCourse(){return this._course}setEvent(t){return this._event=t,this}getEvent(){return this._event}setLength(t){return this._length=t,this}getLength(){return this._length}getFriendlyName(){return this.getVenue()}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */class L{_name;_type;_carClass;_cup;_number;_ballast=0;_restrictor=0;_skin;setName(t){return this._name=t,this}getName(){return this._name}setType(t){return this._type=t,this}getType(){return this._type}setClass(t){return this._carClass=t,this}getClass(){return this._carClass}setCup(t){return this._cup=t,this}getCup(){return this._cup}setNumber(t){return this._number=t,this}getNumber(){return this._number}setBallast(t){return this._ballast=t,this}getBallast(){return this._ballast}setRestrictor(t){return this._restrictor=t,this}getRestrictor(){return this._restrictor}setSkin(t){return this._skin=t,this}getSkin(){return this._skin}getFriendlyName(){return this.getName()}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */const S={0:"Porsche 991 GT3 R",1:"Mercedes-AMG GT3",2:"Ferrari 488 GT3",3:"Audi R8 LMS",4:"Lamborghini Huracan GT3",5:"McLaren 650S GT3",6:"Nissan GT-R Nismo GT3 2018",7:"BMW M6 GT3",8:"Bentley Continental GT3 2018",9:"Porsche 991II GT3 Cup",10:"Nissan GT-R Nismo GT3 2017",11:"Bentley Continental GT3 2016",12:"Aston Martin V12 Vantage GT3",13:"Lamborghini Gallardo R-EX",14:"Jaguar G3",15:"Lexus RC F GT3",16:"Lamborghini Huracan Evo (2019)",17:"Honda NSX GT3",18:"Lamborghini Huracan SuperTrofeo",19:"Audi R8 LMS Evo (2019)",20:"AMR V8 Vantage (2019)",21:"Honda NSX Evo (2019)",22:"McLaren 720S GT3 (2019)",23:"Porsche 911II GT3 R (2019)",24:"Ferrari 488 GT3 Evo 2020",25:"Mercedes-AMG GT3 2020",50:"Alpine A110 GT4",51:"AMR V8 Vantage GT4",52:"Audi R8 LMS GT4",53:"BMW M4 GT4",55:"Chevrolet Camaro GT4",56:"Ginetta G55 GT4",57:"KTM X-Bow GT4",58:"Maserati MC GT4",59:"McLaren 570S GT4",60:"Mercedes-AMG GT4",61:"Porsche 718 Cayman GT4"},T={0:"Overall",1:"Pro-Am",2:"Am",3:"Silver",4:"National"};t.AccReader=class{static defaultTimezone="UTC";_data;_dataStr;_helper;_finishStatusNone50PercentRule=!0;constructor(t={},e,s){this._helper=s||new n,this._data=t,this._dataStr=e}getSession(t=1){const e=this.getSessions();if(!e[t-1])throw new Error(`Cannot find a session for session number ${t}`);return e[t-1]}getSessions(){return this._fixSessions(this._readSessions())}_fixSessions(t){return this._fixGridPositions(t),this._fixFinishStatusBasedOnLaps(t),this._fixLapsData(t),t.forEach((t=>{this._fixParticipantPositions(t.getParticipants())})),t}_readSessions(){const t=this._data||JSON.parse(this._dataStr);if(!t)throw new Error("Unsupported Format");let e=t,r=!1;t.sessionDef&&(e=t.sessionDef,r=!0);let i=e.sessionType;isNaN(i)&&(i=i.replace(/\d/,"").toLowerCase());const n=this._helper.detectSession(i,{0:s.Practice,4:s.Qualify,10:s.Race}),h=e.RaceLaps;h&&n.setMaxLaps(h),n.setRaceWeekendIndex(e.raceWeekendIndex),n.setSessionIndex(e.sessionIndex);const d=(new c).setName("Assetto Corsa Competizione");n.setGame(d);const g=(new _).setName(e.serverName||"Unknown");n.setServer(g);const f=(new m).setVenue(e.trackName||"Unknown");n.setTrack(f);const P=t.sessionResult||t.snapShot;if(P.hasOwnProperty("isWetSession")&&n.addOtherSetting("isWetSession",P.isWetSession),r)throw new Error("Not Implemented");const y=[],B={},C={GT3:0,GT4:0};(P.leaderBoardLines||[]).forEach(((t,e)=>{if(!t.car.carId)return;const s=t.car.drivers.map((t=>(new u).setName(`${t.firstName} ${t.lastName}`.trim()).setDriverId(t.playerId))),r=p.createInstance();r.setDrivers(s).setFinishStatus(o.Normal).setTeam(t.car.teamName),t.timing.totalTime&&r.setTotalTime(t.timing.totalTime/1e3);const i=t.car.carModel,n=S[i]||"Unknown",a=new L;a.setName(n),a.setNumber(t.car.raceNumber),n.includes("GT4")?(a.setClass("GT4"),r.setClassPosition(++C.GT4)):(a.setClass("GT3"),r.setClassPosition(++C.GT3)),void 0!==t.car.cupCategory&&T[t.car.cupCategory]&&a.setCup(T[t.car.cupCategory]),r.setVehicle(a),y.push(r),B[t.car.carId]=r}));const N={},b=[];if((t.laps||[]).forEach((t=>{if(!t.carId||!B[t.carId])return;let e=0;N[t.carId]?e=++N[t.carId]:(N[t.carId]=1,e=N[t.carId]);const r=new a,i=B[t.carId],o=t.driverIndex;r.setParticipant(i),r.setDriver(i.getDriver(o+1)),(n.getType()===s.Race||t.isValidForBest)&&(r.setTime(t.laptime/1e3),t.splits.forEach(((t,s)=>{e>1&&0===s&&b.push(t),r.addSectorTime(t/1e3)}))),i.addLap(r)})),n.getType()===s.Race&&b.length>0){const t=(b.reduce(((t,e)=>t+e),0)/b.length+5e3)/1e3;y.forEach((e=>{e.getLaps().forEach((e=>{const s=e.getSectorTimes();1===e.getNumber()&&s.length&&(s[0]=t,e.setSectorTimes(s),e.setTime(s.reduce(((t,e)=>t+e),0)))}))}))}const v=[];return(t.penalties||[]).forEach((t=>{if(!t.carId)return;const e=new l,r=B[t.carId],i=t.driverIndex;e.setMessage(r.getDriver(i+1).getName()+" - "+(t.reason||"Unknown reason")+" - "+t.penalty+" - "+`violation in lap ${t.violationInLap||"unknown"} - `+`cleared in lap ${t.clearedInLap||"unknown"}`);const a=r.getLap(t.violationInLap),o=r.getLap(t.clearedInLap);a&&e.setLap(a),o&&e.setServedLap(o),e.setReason(t.reason).setPenalty(t.penalty).setParticipant(r).setServed(Boolean(t.clearedInLap)),v.push(e),n.getType()!==s.Race&&"RemoveBestLaptime"===t.penalty&&a&&(a.setTime(void 0),a.setSectorTimes([]))})),n.setPenalties(v),n.setParticipants(y),this._data=null,this._dataStr=null,[n]}_fixGridPositions(t){let e={};t.forEach((t=>{t.getType()===s.Qualify?(e={},t.getParticipants().forEach((t=>{const s=t.getDriver().getName();s&&(e[s]=t.getPosition())}))):t.getType()===s.Race&&t.getParticipants().forEach((t=>{const s=t.getDriver().getName();s&&e[s]&&!t.getGridPosition()&&t.setGridPosition(e[s])}))}))}_fixFinishStatusBasedOnLaps(t){t.forEach((t=>{t.getType()===s.Race&&t.getParticipants().forEach((e=>{0===e.getNumberOfCompletedLaps()?e.setFinishStatus(o.DNF):this._finishStatusNone50PercentRule&&e.getFinishStatus()===o.Normal&&(!e.getNumberOfCompletedLaps()||e.getNumberOfCompletedLaps()/(t.getLastedLaps()/100)<50)&&e.setFinishStatus(o.None)}))}))}_fixLapsData(t){t.forEach((t=>{t.getParticipants().forEach((t=>{let e=0;t.getLaps().forEach(((t,s)=>{t.getElapsedSeconds()||(t.getTime()&&t.setElapsedSeconds(e),e+=t.getTime()),t.getNumber()||t.setNumber(s+1)}))}));const e=t.getParticipants(),s=e.length&&e[0].getLap(2);if(s&&!s.getPosition()){let e=t.getLastedLaps();for(let s=2;s<=e;s++){const e=t.getLapsByLapNumberSortedByTime(s);this._helper.sortLapsByElapsedTime(e).forEach(((t,e)=>{t.getPosition()||!t.getTime()&&!t.getElapsedSeconds()||t.setPosition(e+1)}))}}}))}_fixParticipantPositions(t){t.forEach(((t,e)=>{t.setPosition(e+1)}))}_sortParticipantsAndFixPositions(t,e,r=!1){let i=[];if(e.getType()===s.Race){let s=!1;r&&(s=!0,e.getParticipants().forEach((t=>{t.getFinishStatus()!==o.None&&(s=!1)}))),i=s?this._helper.sortParticipantsByLastLapPosition(t):this._helper.sortParticipantsByTotalTime(t)}else i=this._helper.sortParticipantsByBestLap(t);return this._fixParticipantPositions(i),t}},t.Cache=e,t.CachedParticipant=p,t.CachedSession=i,t.Chat=class{date;message;elapsedSeconds;setMessage(t){return this.message=t,this}getMessage(){return this.message}setDate(t){return this.date=t,this}getDate(){return this.date}setElapsedSeconds(t){return this.elapsedSeconds=t,this}getElapsedSeconds(){return this.elapsedSeconds}}
/**
     * @author     Maurice van der Star <mauserrifle@gmail.com>
     * @copyright  (c) 2013 Maurice van der Star
     * @license    http://opensource.org/licenses/ISC
    */,t.Cut=class{_cutTime;_timeSkipped;_lap;_date;_elapsedSeconds;_elapsedSecondsInLap;setCutTime(t){return this._cutTime=t,this}getCutTime(){return this._cutTime}setTimeSkipped(t){return this._timeSkipped=t,this}getTimeSkipped(){return this._timeSkipped}setLap(t){return this._lap=t,this}getLap(){return this._lap}setDate(t){return this._date=t,this}getDate(){return this._date}setElapsedSeconds(t){return this._elapsedSeconds=t,this}getElapsedSeconds(){return this._elapsedSeconds}setElapsedSecondsInLap(t){return this._elapsedSecondsInLap=t,this}getElapsedSecondsInLap(){return this._elapsedSecondsInLap}},t.Driver=u,t.Finish=o,t.Game=c,t.Helper=n,t.Incident=class{_type=d.Unknown;_message;_date;_elapsedSeconds;_forReview;_participant;_otherParticipant;setMessage(t){return this._message=t,this}getMessage(){return this._message}setDate(t){return this._date=t,this}getDate(){return this._date}setElapsedSeconds(t){return this._elapsedSeconds=t,this}getElapsedSeconds(){return this._elapsedSeconds}setForReview(t){return this._forReview=t,this}isForReview(){return this._forReview}setType(t){return this._type=t,this}getType(){return this._type}setParticipant(t){return this._participant=t,this}getParticipant(){return this._participant}setOtherParticipant(t){return this._otherParticipant=t,this}getOtherParticipant(){return this._otherParticipant}},t.IncidentType=d,t.Lap=a,t.Participant=h,t.Penalty=l,t.Server=_,t.Session=r,t.SessionType=s,t.Track=m,t.Vehicle=L,Object.defineProperty(t,"__esModule",{value:!0})}));
